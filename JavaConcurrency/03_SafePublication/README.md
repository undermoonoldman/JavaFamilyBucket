# ***安全发布对象***

## 发布对象 : 使一个对象能够被当前范围之外的代码所使用

## 对象逸出 : 一种错误的发布。当一个对象还没有构造完成时，就使它被其他线程所见

---

## ***以单例模式为例子***

1. ### 普通懒汉单例(线程不安全)

2. ### 普通静态饿汉单例(线程安全)

3. ### 工厂方法加锁懒汉单例(线程安全，性能开销大，不推荐)

4. ### 普通双重检查加锁懒汉单例(由于指令重排会有不安全发布的风险，线程不安全)

5. ### 加volatile的双重检查加锁懒汉单例(volatile禁止了指令重排，线程安全)

6. ### 静态块饿汉单例(静态块需要在单例引用的后面，否则会有发布空引用的危险)

7. ### 枚举单例(JVM保证，推荐)

## 安全发布对象的手段

1. ### 在静态初始化函数中初始化一个对象引用(like2)

2. ### 将对象的引用保存到volatile类型域或者AtomicReference对象中(like5)

3. ### 将对象的引用保存到某个正确构造对象的final类型域中(本节未给出示例)

4. ### 将对象的引用保存到一个由锁保护的域中(like3)

